# nx-code-coverage github action
This is a github action for combining/compiling lcov code coverage from an nx monorepo (although will probably work for other mono/single repos).
  - This will loop through the coverage folder which should contain all the projects and their coverage results (lcov.info).
  - On a PR execution, this will update the PR with a PR Commit displaying the coverage results for those projects
  - On a push execution, this will update coverage badges for all projects (using the gist method specified [here](https://dev.to/thejaredwilcurt/coverage-badge-with-github-actions-finally-59fa)

> [GitHub Action](https://help.github.com/en/actions) to combine/compile lcov code coverage from an nx monorepo 

-   ✅ &nbsp;Code coverage comment for monorepo
-   ✅ &nbsp;Code coverage diff if base lcov provided
-   ✅ &nbsp;Updates the Code coverage comment instead of adding new

The report is based on the lcov coverage report generated by your test runner.

## Inputs
See [action.yml](./action.yml)

## Setup
- Perform gist setup from https://dev.to/thejaredwilcurt/coverage-badge-with-github-actions-finally-59fa
- Must run nx:affected test --coverage so the coverage results already exist
```
      - name: Comment Code Coverage on PR
        uses: dkhunt27/nx-code-coverage@v0.3.0
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          coverage-folder: ./coverage
          coverage-base-folder: ./coverage-base
          gist-token: ${{ secrets.COVERAGE_BADGES_GIST_TOKEN }}
          gist-id: d7e6b443a01eba615fd2a7c1215aec91
          color: green
          named-logo: jest
```
- See sample workflows 
  - [main-push.yaml](./.github/samples/main-push.yaml)
  - [pull-request.yaml](./.github/samples/pull-request.yaml)
  
## Making changes and pushing releases

+ wait for pipelines to finish
+ git checkout main
+ git pull 
+ git tag v0.3.0
+ SKIP_HOOKS=true git push origin v0.3.0
+ in github, edit tag and save (this will push to marketplace)


## NPM Check
```
npm run npm:check
```

## Acknowledgements
Thanks to the creators of the code that this was based on 

  - [eeshdarthvader/code-coverage-assistant](https://github.com/eeshdarthvader/code-coverage-assistant)
  - [romeovs/lcov-reporter-action](https://github.com/romeovs/lcov-reporter-action).
  - [ziishaned/jest-reporter-action](https://github.com/ziishaned/jest-reporter-action)
  - [slavcodev/coverage-monitor-action](https://github.com/slavcodev/coverage-monitor-action)

## License

[MIT](LICENSE)



## Validate

You can now validate the action by referencing `./` in a workflow in your repo (see [test.yml](.github/workflows/test.yml))

```yaml
uses: ./
with:
  milliseconds: 1000
```

See the [actions tab](https://github.com/actions/typescript-action/actions) for runs of this action! :rocket:

## Usage:

After testing you can [create a v1 tag](https://github.com/actions/toolkit/blob/master/docs/action-versioning.md) to reference the stable and latest V1 action
